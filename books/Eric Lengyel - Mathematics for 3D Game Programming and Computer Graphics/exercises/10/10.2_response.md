### Answer 10.2

**Algorithm for Stencil Shadow Rendering**

**1. Precalculation (Edge Construction)**
Iterate through the triangle mesh to build a list of unique edges. Each edge stores references to the two triangles sharing it.

**2. Per-Frame Rendering Loop**

**A. Initialization**
* Clear Stencil Buffer to 0.
* Disable writing to Color and Depth buffers (`glColorMask(0...)`, `glDepthMask(0)`).
* Enable Stencil Test (Always Pass).
* Enable Depth Test (Less Than).

**B. Silhouette Determination**
For the light position $L$:
* Iterate through all triangles. Calculate $N \cdot (Center - L)$ (or $N \cdot L$ depending on convention) to classify as facing **toward** or **away**.
* Iterate through all edges. An edge is a **silhouette edge** if it is shared by one triangle facing toward the light and one facing away.

**C. Shadow Volume Extrusion**
For each silhouette edge with vertices $A$ and $B$:
* Construct a quad with vertices $A, B, B_\infty, A_\infty$.
* $A_\infty$ is the projection of $A$ to infinity along the vector $A-L$ (homogeneous $w=0$).

**D. Render to Stencil Buffer (Z-Fail / Carmack's Reverse)**
* **Back Faces:** Increment stencil if depth test fails.
    `glStencilOpSeparate(GL_BACK, GL_KEEP, GL_INCR_WRAP, GL_KEEP)`
* **Front Faces:** Decrement stencil if depth test fails.
    `glStencilOpSeparate(GL_FRONT, GL_KEEP, GL_DECR_WRAP, GL_KEEP)`
* Draw the extruded quads (and caps if using the robust method).

**E. Lighting Pass**
* Enable Color/Depth writes.
* Set Stencil Function to `GL_EQUAL` to 0 (draw only non-shadowed pixels).
* Set Depth Function to `GL_EQUAL` (prevent Z-fighting with ambient pass).
* Render the mesh with additive blending (`glBlendFunc(GL_ONE, GL_ONE)`).
