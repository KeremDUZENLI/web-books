### Answer 7.6

To modify the isotropic microfacet shader (Listing 7.3) for bump mapping, we must perform the lighting calculations using a perturbed normal from a texture map.

**Modifications required:**

1.  **Vertex Shader Attributes**: Add a `tangent` attribute and pass the interpolated Tangent, Bitangent, and Normal (TBN) vectors to the fragment shader, or transform the View ($V$) and Light ($L$) vectors into Tangent Space in the vertex shader.

2.  **Fragment Shader Sampler**: Add a `sampler2D` uniform for the Normal Map (bump map).

3.  **Normal Perturbation**:
    * Sample the normal map texture: `vec3 mapNormal = texture2D(normalMap, texCoord).xyz;`
    * Expand range from $[0, 1]$ to $[-1, 1]$: `vec3 N = normalize(mapNormal * 2.0 - 1.0);`
    * (If doing calculations in Tangent Space, this sampled `N` is used directly as the surface normal. If doing calculations in World Space, multiply this `N` by the TBN matrix).

4.  **Lighting Calculation**:
    * Recalculate dot products using the new `N`: `dot(N, L)` and `dot(N, H)`.
    * Use these new dot products in the existing microfacet equations for diffuse and specular terms.

**Logic Flow**:
`N = SampleNormalMap(uv)`
`diffuse = k * C * D * max(dot(N, L), 0)`
`specular = (1-k) * C * Microfacet(N, H, L, V)`
`finalColor = diffuse + specular`
