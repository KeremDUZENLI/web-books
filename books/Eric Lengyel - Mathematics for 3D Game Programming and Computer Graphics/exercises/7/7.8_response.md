### Answer 7.8

To extend the ray tracer for Cook-Torrance shading, replace the standard specular calculation (Step 4 "Specular" in Exercise 7.7) with the Cook-Torrance BRDF (Equation 7.54).

**Algorithm Changes:**

1.  **Material Properties**: Add Roughness $m$ (root mean square slope) and Index of Refraction $\eta$ (or $F_0$ color) to sphere definitions.

2.  **Specular Term Calculation**:
    * Instead of $K_{spec} = S \cdot \dots$, calculate $\rho_s$:
        $$\rho_s = \frac{F(V, L) \cdot D(V, L) \cdot G(V, L)}{\pi (N \cdot V) (N \cdot L)}$$

    * **Fresnel (F)**: Use Equation 7.68 or Schlick's approximation.
        $$F \approx F_0 + (1 - F_0)(1 - (L \cdot H))^5$$

    * **Distribution (D)**: Use Beckmann distribution (Eq 7.71).
        $$D = \frac{1}{4m^2 (N \cdot H)^4} \exp\left( \frac{(N \cdot H)^2 - 1}{m^2 (N \cdot H)^2} \right)$$

    * **Geometric Attenuation (G)**: Use Equation 7.80.
        $$G = \min\left(1, \frac{2(N \cdot H)(N \cdot V)}{V \cdot H}, \frac{2(N \cdot H)(N \cdot L)}{V \cdot H}\right)$$

    * **Final Term**: $K_{spec} = \text{LightColor} \cdot (N \cdot L) \cdot \rho_s$.
        *(Note: The $N \cdot L$ in the lighting equation cancels out the $N \cdot L$ in the BRDF denominator, simplifying the calculation).*
